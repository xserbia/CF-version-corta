<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
  <title>Calculadora Financiera</title>
  <!-- Conexión al CSS externo -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
<!-- 🔝 Navegación superior -->
<div id="topNav" class="top-navigation">
  <button class="nav-btn active" onclick="irASeccion('stepIngresos')">Ingreso</button>
  <button id="btnGastos" class="nav-btn" onclick="validarAntesDeIrAGastos()" disabled>Gastos</button>
  <button id="btnActivos" class="nav-btn" onclick="validarAntesDeIrAActivos()" disabled>Activos</button>
</div>

<!-- 🔹 FORMULARIO: Step Ingresos -->
<div class="step active" id="stepIngresos">
  <fieldset>
    <legend>Ingresos y Ahorros</legend>

    <label for="ingreso_bruto">Ingreso anual bruto
      <span class="tooltip" data-tooltip="Suma total de ingresos antes de impuestos: salario, negocio, bonos, dividendos, rentas, etc.">🛈</span>
    </label>
    <input type="number" id="ingreso_bruto" name="ingreso_bruto" required onblur="validarCampo(this)">

    <label for="aporte_personal_retiro">Aporte personal a retiro
      <span class="tooltip" data-tooltip="Aporte que realizas de tu salario hacia tu fondo de retiro 401k, IRA, o similar.">🛈</span>
    </label>
    <input type="number" id="aporte_personal_retiro" name="aporte_personal_retiro" required onblur="validarCampo(this)">

    <label for="aporte_empleador_retiro">Aporte del empleador a retiro
      <span class="tooltip" data-tooltip="Aporte que tu empleador realiza a tu fondo de retiro, si aplica.">🛈</span>
    </label>
    <input type="number" id="aporte_empleador_retiro" name="aporte_empleador_retiro" required onblur="validarCampo(this)">

    <label for="otros_ahorros">Otros ahorros
      <span class="tooltip" data-tooltip="Cualquier otra forma de ahorro anual: ahorro bancario, fondos de emergencia, etc.">🛈</span>
    </label>
    <input type="number" id="otros_ahorros" name="otros_ahorros" required onblur="validarCampo(this)">
  </fieldset>
</div>
  
  <!-- 2. Gastos -->
<div class="step" id="stepGastos">
  <fieldset>
    <legend>Gastos Anuales</legend>

    <label for="pago_deudas">Pago por deudas
      <span class="tooltip" data-tooltip="Pagos anuales de hipotecas, préstamos personales, automotrices, educativos y tarjetas de crédito.">🛈</span>
    </label>
    <input type="number" id="pago_deudas" name="pago_deudas" required onblur="validarCampo(this)">

    <label for="gastos_diarios">Gastos diarios esenciales
      <span class="tooltip" data-tooltip="Incluye supermercado, transporte, servicios públicos, telecomunicaciones y mantenimiento básico.">🛈</span>
    </label>
    <input type="number" id="gastos_diarios" name="gastos_diarios" required onblur="validarCampo(this)">

    <label for="impuestos_anuales">Impuestos anuales
      <span class="tooltip" data-tooltip="Pagos de impuestos federales, estatales, municipales, de propiedad y de vehículo.">🛈</span>
    </label>
    <input type="number" id="impuestos_anuales" name="impuestos_anuales" required onblur="validarCampo(this)">

    <label for="seguros_anuales">Seguros anuales
      <span class="tooltip" data-tooltip="Pagos de seguros de salud, vida, propiedad, auto y umbrella.">🛈</span>
    </label>
    <input type="number" id="seguros_anuales" name="seguros_anuales" required onblur="validarCampo(this)">
  </fieldset>
</div>

  <!-- 3. Activos -->
<div class="step" id="stepActivos">
  <fieldset>
    <legend>Activos</legend>

    <label for="efectivo_similar">Efectivo y similares
      <span class="tooltip" data-tooltip="Cuentas bancarias, efectivo, money market.">🛈</span>
    </label>
    <input type="number" id="efectivo_similar" name="efectivo_similar" required onblur="validarCampo(this)">

    <label for="cuentas_inversion">Cuentas de inversión (no retiro)
      <span class="tooltip" data-tooltip="Fondos mutuos, acciones, bonos.">🛈</span>
    </label>
    <input type="number" id="cuentas_inversion" name="cuentas_inversion" required onblur="validarCampo(this)">

    <label for="cuentas_retiro">Cuentas de retiro
      <span class="tooltip" data-tooltip="401(k), IRA, Roth, etc.">🛈</span>
    </label>
    <input type="number" id="cuentas_retiro" name="cuentas_retiro" required onblur="validarCampo(this)">

    <label for="valor_propiedades">Propiedades
      <span class="tooltip" data-tooltip="Valor de tus viviendas o propiedades de inversión.">🛈</span>
    </label>
    <input type="number" id="valor_propiedades" name="valor_propiedades" required onblur="validarCampo(this)">

    <label for="otros_activos">Otros activos
      <span class="tooltip" data-tooltip="Autos, joyas, arte, etc.">🛈</span>
    </label>
    <input type="number" id="otros_activos" name="otros_activos" required onblur="validarCampo(this)">

    <div class="nav-buttons">
      <button type="button" onclick="mostrarResultadoActivos()">Calcular</button>
    </div>
  </fieldset>
</div>

<!-- 🔵 Contenedor de Resultados -->
  <div id="navResultados">
  <button class="nav-btn" onclick="mostrarResultado('resA')">🅰 Ingresos</button>
  <button class="nav-btn" onclick="mostrarResultado('resB')">🅱 Gastos</button>
  <button class="nav-btn" onclick="mostrarResultado('resC')">🅲 Activos</button>
</div>
<div id="resultadosContainer" style="display: none;">
  <h2>🧮 Resultado Calculado</h2>

  <!-- 🅰 Ingresos -->
  <div id="resA" class="resultado-categoria mostrar">
    <p id="resultadoBasico">Resultado aún no calculado.</p>
  </div>

  <!-- 🅱 Gastos -->
  <div id="resB" class="resultado-categoria"></div>

  <!-- 🅲 Activos -->
  <div id="resC" class="resultado-categoria"></div>
</div>

  <!-- 🔁 En uso temporal -->
  <div id="resultadoGastos" style="margin-top: 20px;"></div>
</div>
  
<script>
  // Navegar entre secciones
  function irASeccion(id) {
    const pasos = document.querySelectorAll(".step");
    pasos.forEach(p => p.classList.remove("active"));
    const pasoActual = document.getElementById(id);
    if (pasoActual) pasoActual.classList.add("active");

    const botones = document.querySelectorAll(".nav-btn");
    botones.forEach(b => b.classList.remove("active"));
    const botonActivo = Array.from(botones).find(b => b.getAttribute("onclick")?.includes(id));
    if (botonActivo) botonActivo.classList.add("active");
  }

  // Validar campo individual visualmente
  function validarCampo(input) {
    const valor = parseFloat(input.value);
    if (isNaN(valor) || valor < 0) {
      input.style.borderColor = "red";
    } else {
      input.style.borderColor = "#44008f";
    }
  }

  // 🅰️ Mostrar resultado de ingresos y pasar a gastos
  function mostrarResultadoBasico() {
    const campos = [
      "ingreso_bruto",
      "aporte_personal_retiro",
      "aporte_empleador_retiro",
      "otros_ahorros"
    ];

    let camposValidos = true;

    campos.forEach(id => {
      const input = document.getElementById(id);
      const valor = parseFloat(input.value);
      if (isNaN(valor) || valor < 0) {
        input.classList.add("shake");
        input.style.borderColor = "red";
        camposValidos = false;
        setTimeout(() => input.classList.remove("shake"), 300);
      } else {
        input.style.borderColor = "#44008f";
      }
    });

    if (!camposValidos) return;

    const ingresoBruto = parseFloat(document.getElementById("ingreso_bruto").value) || 0;
    const aportePersonal = parseFloat(document.getElementById("aporte_personal_retiro").value) || 0;
    const aporteEmpleador = parseFloat(document.getElementById("aporte_empleador_retiro").value) || 0;
    const otrosAhorros = parseFloat(document.getElementById("otros_ahorros").value) || 0;
    const totalAhorros = aportePersonal + aporteEmpleador + otrosAhorros;
    const tasaAhorro = ingresoBruto > 0 ? (totalAhorros / ingresoBruto) * 100 : 0;

    const html = `
      <h4>🟩 Ingresos Anuales</h4>
      <p><strong>Ingreso anual bruto:</strong> $${ingresoBruto.toLocaleString()}</p>
      <p><strong>Aporte personal a retiro:</strong> $${aportePersonal.toLocaleString()}</p>
      <p><strong>Aporte del empleador:</strong> $${aporteEmpleador.toLocaleString()}</p>
      <p><strong>Otros ahorros:</strong> $${otrosAhorros.toLocaleString()}</p>
      <p><strong>Total de ahorros:</strong> $${totalAhorros.toLocaleString()}</p>
      <p><strong>Tasa de ahorro:</strong> ${tasaAhorro.toFixed(1)}%</p>
    `;

    document.getElementById("resultadoBasico").innerHTML = html;
    document.getElementById("resultadosContainer").style.display = "block";

    // ✅ Activar botón de navegación a Gastos
    document.getElementById("btnGastos").disabled = false;

    // Ir a sección gastos
    irASeccion("stepGastos");
  }

  // 🅱️ Mostrar resultado de gastos y pasar a activos
  function mostrarResultadoGastos() {
    const campos = [
      "pago_deudas",
      "gastos_diarios",
      "impuestos_anuales",
      "seguros_anuales"
    ];

    let camposValidos = true;

    campos.forEach(id => {
      const input = document.getElementById(id);
      const valor = parseFloat(input.value);
      if (isNaN(valor) || valor < 0) {
        input.classList.add("shake");
        input.style.borderColor = "red";
        camposValidos = false;
        setTimeout(() => input.classList.remove("shake"), 300);
      } else {
        input.style.borderColor = "#44008f";
      }
    });

    if (!camposValidos) return;

    const deudas = parseFloat(document.getElementById("pago_deudas").value) || 0;
    const diarios = parseFloat(document.getElementById("gastos_diarios").value) || 0;
    const impuestos = parseFloat(document.getElementById("impuestos_anuales").value) || 0;
    const seguros = parseFloat(document.getElementById("seguros_anuales").value) || 0;
    const total = deudas + diarios + impuestos + seguros;

    const html = `
      <h4>🟨 Gastos Anuales</h4>
      <p><strong>Pago por deudas:</strong> $${deudas.toLocaleString()}</p>
      <p><strong>Gastos diarios esenciales:</strong> $${diarios.toLocaleString()}</p>
      <p><strong>Impuestos:</strong> $${impuestos.toLocaleString()}</p>
      <p><strong>Seguros:</strong> $${seguros.toLocaleString()}</p>
      <p><strong>Total de gastos:</strong> $${total.toLocaleString()}</p>
    `;

    document.getElementById("resB").innerHTML = html;
    document.getElementById("resultadosContainer").style.display = "block";

    // ✅ Activar botón de navegación a Activos
    document.getElementById("btnActivos").disabled = false;

    // Ir a sección activos
    irASeccion("stepActivos");
  }

  // 🅲 Mostrar resultado de activos
  function mostrarResultadoActivos() {
    const campos = [
      "efectivo_similar",
      "cuentas_inversion",
      "cuentas_retiro",
      "valor_propiedades",
      "otros_activos"
    ];

    let camposValidos = true;

    campos.forEach(id => {
      const input = document.getElementById(id);
      const valor = parseFloat(input.value);
      if (isNaN(valor) || valor < 0) {
        input.classList.add("shake");
        input.style.borderColor = "red";
        camposValidos = false;
        setTimeout(() => input.classList.remove("shake"), 300);
      } else {
        input.style.borderColor = "#44008f";
      }
    });

    if (!camposValidos) return;

    const efectivo = parseFloat(document.getElementById("efectivo_similar").value) || 0;
    const inversiones = parseFloat(document.getElementById("cuentas_inversion").value) || 0;
    const retiro = parseFloat(document.getElementById("cuentas_retiro").value) || 0;
    const propiedades = parseFloat(document.getElementById("valor_propiedades").value) || 0;
    const otros = parseFloat(document.getElementById("otros_activos").value) || 0;
    const total = efectivo + inversiones + retiro + propiedades + otros;

    const html = `
      <h4>🟦 Activos Totales</h4>
      <p><strong>Efectivo y similares:</strong> $${efectivo.toLocaleString()}</p>
      <p><strong>Cuentas de inversión:</strong> $${inversiones.toLocaleString()}</p>
      <p><strong>Cuentas de retiro:</strong> $${retiro.toLocaleString()}</p>
      <p><strong>Propiedades:</strong> $${propiedades.toLocaleString()}</p>
      <p><strong>Otros activos:</strong> $${otros.toLocaleString()}</p>
      <p><strong>Total de activos:</strong> $${total.toLocaleString()}</p>
    `;

    document.getElementById("resC").innerHTML = html;
    document.getElementById("resultadosContainer").style.display = "block";

    // Si luego deseas activar btnPasivos, puedes hacerlo aquí
  }

  // Validar antes de pasar a Gastos desde el topNav
  function validarAntesDeIrAGastos() {
    const campos = [
      "ingreso_bruto",
      "aporte_personal_retiro",
      "aporte_empleador_retiro",
      "otros_ahorros"
    ];

    let completado = true;

    campos.forEach(id => {
      const input = document.getElementById(id);
      const valor = parseFloat(input.value);
      if (isNaN(valor) || valor < 0) {
        input.classList.add("shake");
        input.style.borderColor = "red";
        completado = false;
        setTimeout(() => input.classList.remove("shake"), 300);
      } else {
        input.style.borderColor = "#44008f";
      }
    });

    if (completado) {
      irASeccion("stepGastos");
    }
  }

  // Validar antes de pasar a Activos desde el topNav
  function validarAntesDeIrAActivos() {
    const campos = [
      "pago_deudas",
      "gastos_diarios",
      "impuestos_anuales",
      "seguros_anuales"
    ];

    let completado = true;

    campos.forEach(id => {
      const input = document.getElementById(id);
      const valor = parseFloat(input.value);
      if (isNaN(valor) || valor < 0) {
        input.classList.add("shake");
        input.style.borderColor = "red";
        completado = false;
        setTimeout(() => input.classList.remove("shake"), 300);
      }
    });

    if (completado) {
      irASeccion("stepActivos");
    }
  }

  // Mostrar la sección de ingresos al cargar
  document.addEventListener("DOMContentLoaded", () => {
    irASeccion("stepIngresos");
  });

  // Navegación entre pestañas de resultados
  function mostrarResultado(id) {
    const secciones = document.querySelectorAll(".resultado-categoria");
    secciones.forEach(s => s.classList.remove("mostrar"));
    const activa = document.getElementById(id);
    if (activa) activa.classList.add("mostrar");
  }
</script>

</body>
</html>
